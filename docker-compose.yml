services:
  api:
    build: ./api
    container_name: webhoxy-api
    ports:
      - "${API_PORT:-8080}:${API_PORT:-8080}"
    environment:
      - PORT=${API_PORT:-8080}
      - HOST=${API_HOST:-0.0.0.0}
      - NODE_ENV=${NODE_ENV:-production}
      - DATABASE_URL=${DATABASE_URL:-./data/webhoxy.db}
      - CORS_ORIGIN=${CORS_ORIGIN:-*}
    networks:
      - webhoxy-network
    volumes:
      - webhoxy-data:/app/data
    restart: unless-stopped

  web:
    build:
      context: ./web
      args:
        VITE_API_URL: ${API_URL:-http://localhost:${API_PORT:-8080}/api}
        VITE_WEBHOOK_URL: ${WEBHOOK_URL:-}
    container_name: webhoxy-web
    ports:
      - "${WEB_PORT:-80}:80"
    environment:
      - VITE_API_URL=${API_URL:-http://localhost:${API_PORT:-8080}/api}
      - VITE_WEB_URL=${WEB_URL:-http://localhost:${WEB_PORT:-80}}
      - VITE_WEB_PORT=${WEB_PORT:-80}
    depends_on:
      - api
    networks:
      - webhoxy-network
    restart: unless-stopped

networks:
  webhoxy-network:
    driver: bridge

volumes:
  webhoxy-data:
